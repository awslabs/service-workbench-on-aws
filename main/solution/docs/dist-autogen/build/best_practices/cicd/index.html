<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">CI/CD | Service Workbench Platform</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="CI/CD | Service Workbench Platform"><meta data-react-helmet="true" name="description" content="We recommend that you setup a CI/CD pipeline for this solution. This section will provide you with an overview of how to do this."><meta data-react-helmet="true" property="og:description" content="We recommend that you setup a CI/CD pipeline for this solution. This section will provide you with an overview of how to do this."><meta data-react-helmet="true" property="og:url" content="https://override-me.com/docs/best_practices/cicd"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://override-me.com/docs/best_practices/cicd"><link rel="stylesheet" href="/docs/styles.fbe4f043.css">
<link rel="preload" href="/docs/styles.c0a53c60.js" as="script">
<link rel="preload" href="/docs/runtime~main.76781b24.js" as="script">
<link rel="preload" href="/docs/main.7eb1c7c3.js" as="script">
<link rel="preload" href="/docs/1.7cbe52f2.js" as="script">
<link rel="preload" href="/docs/2.49368f54.js" as="script">
<link rel="preload" href="/docs/59.d1c041d7.js" as="script">
<link rel="preload" href="/docs/935f2afb.1e90a91b.js" as="script">
<link rel="preload" href="/docs/17896441.5294e2c1.js" as="script">
<link rel="preload" href="/docs/890fe081.ca191dfd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs/"><strong class="navbar__title">Home</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Latest</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_30In"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3wy4">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3wy4">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/"><strong class="navbar__title">Home</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link">Versions</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3Kyr"><div class="docSidebarContainer_1Hfm" role="complementary"><div class="sidebar_3xSI"><div class="menu menu--responsive menu_2LhH"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_3ELd" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Service Workbench</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/summary">Summary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/redeployment">Deploying Updates</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Pre Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/pre_deployment/prerequisites">Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/pre_deployment/prereq_commands">Prerequisite Software</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/pre_deployment/deployment_instance">Deployment Instance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/pre_deployment/source_code">Source Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/pre_deployment/configuration">Configuration</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/deployment/index">Deployment</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Post Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/post_deployment/index">Post Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/post_deployment/link_aws_account">Create or add an AWS Account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/post_deployment/create_index_project">Create Indexes and Projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/post_deployment/create_admin_user">Create an admin user</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Configuration</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Authentication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/configuration/auth/configuring_auth0">Configuring Auth0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/configuration/auth/configuring_idp">Configuring an Identity Provider</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/redeployment">Deploying Updates</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/reference/iam_role">Add an IAM role to an instance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/reference/aws_services">AWS Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deployment/reference/account_structure">Account Structure</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/introduction">Sidebar Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Sidebar</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Researcher View</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/dashboard/introduction">Dashboard</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Studies</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/creating_a_study">Creating a Study</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/uploading_files">Uploading Files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/sharing_a_study">Sharing a Study</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workspaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/create_workspace_study">Creating a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/terminating_a_workspace">Terminating a Workspace</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Administrator View</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/dashboard/introduction">Dashboard</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Auth</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/auth/introduction">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Users &amp; Roles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/users/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/users/user_roles">User Roles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/users/add_federated_user">Adding Federated Users</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Accounts</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Projects</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/projects/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/projects/create_project">Create Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/projects/add_user_to_project">Adding a User to a Project</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Indexes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/indexes/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/indexes/create_new_index">Create a New Index</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">AWS Accounts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/aws_accounts/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/aws_accounts/create_member_account">Create an AWS Account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/aws_accounts/invite_member_account">Invite an AWS Member Account</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Roles and Permissions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/aws_accounts/master_role">Master Account Role</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/accounts/aws_accounts/cross_account_execution_role">Cross Account Execution Role</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API Keys</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/api_keys/introduction">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Studies</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/creating_a_study">Creating a Study</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/uploading_files">Uploading Files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/studies/sharing_a_study">Sharing a Study</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workspaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/create_workspace_study">Creating a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/common/workspaces/terminating_a_workspace">Terminating a Workspace</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sidebar/admin/workflows/introduction">Introduction</a></li></ul></li></ul></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/multiple_deployment_environments">Multiple Deployment Environments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/amazon_inspector">Amazon Inspector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/aws_cloudtrail">AWS CloudTrail</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/aws_shield">AWS Shield</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/best_practices/cicd">CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/best_practices/rotating_jwt_token">Rotating the JWT Master Token</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/development/introduction">Introduction</a></li></ul></li></ul></div></div></div><main class="docMainContainer_14oX"><div class="container padding-vert--lg docItemWrapper_3CU2"><div class="row"><div class="col docItemCol_u6l3"><div class="docItemContainer_34jG"><article><header><h1 class="docTitle_FuEj">CI/CD</h1></header><div class="markdown"><p>We recommend that you setup a CI/CD pipeline for this solution. This section will provide you with an overview of how to do this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="terminology"></a>Terminology<a aria-hidden="true" tabindex="-1" class="hash-link" href="#terminology" title="Direct link to heading">#</a></h2><ul><li><strong>Source Account:</strong> AWS Account containing CodeCommit repository with the source code</li><li><strong>Target Account:</strong> AWS Account where the solution needs to be deployed to. The CodePipeline is also deployed in the target account.</li><li><strong>Staging Environment:</strong> Solution environment created to run integration tests or manual tests before deploying the solution to final target environment.</li><li><strong>Target Environment:</strong> Target solution environment where the code needs to be deployed.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="how-the-cicd-pipeline-works"></a>How the CI/CD pipeline works<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-the-cicd-pipeline-works" title="Direct link to heading">#</a></h2><p>At high level the pipeline works as follows:</p><ol><li>Every commit in the source account on the configured repo for the specified branch triggers a CloudWatch event.</li><li>A CloudWatch Rule pushes the event to the default event bus of the target account.</li><li>A CloudWatch Rule in the target account triggers the CodePipeline.</li><li>The pipeline contains the following stages and executes them in order. The pipeline stops upon failure of any stage and notifies user via configured SNS topic.<ol><li><strong>Source:</strong> This stage takes the code from the CodeCommit repository from the specified branch and uploads it to an S3 bucket. This S3 bucket is called artifacts bucket and is used by the CodePipeline to pass artifacts from one stage to other stage.</li><li><strong>Build-And-Deploy-To-Staging-Env:</strong> This stage uses <a href="https://aws.amazon.com/codebuild/" target="_blank" rel="noopener noreferrer">AWS CodeBuild</a> to  perform build and deployment. It downloads the code from the artifacts S3 bucket and installs dependencies, performs the static code analysis, runs unit tests, and deploys to the staging environment. This stage is only created if <code>createStagingEnv</code> setting is set to <code>true</code> in settings file. Developers can set <code>createStagingEnv</code> to <code>false</code> to skip creation and deployment to staging environment and directly push changes to their target development environment. This flag should be set to <code>true</code> for higher environments (such as <code>demo</code> or <code>production</code>) to make sure code is deployed and tested in a staging environment before pushing to target environment.</li><li><strong>Test-Staging-Env:</strong> This stage uses <a href="https://aws.amazon.com/codebuild/" target="_blank" rel="noopener noreferrer">AWS CodeBuild</a> to execute integration tests against the staging environment. This stage is only created if <code>createStagingEnv</code> setting is set to <code>true</code> in settings file. Developers can set <code>createStagingEnv</code> to <code>false</code> to skip creation and deployment to staging environment and directly push changes to their target development environment.</li><li><strong>Push-To-Target-Env:</strong> This stage is for manual approval to deploy to target environment. The pipeline will pause at this stage and wait for manual approval. The user will receive an email notification via configured SNS topic. The notification email address is configured via the setting <code>emailForNotifications</code> in the settings file. This stage is only created if <code>requireManualApproval</code> setting is set to <code>true</code> in settings file. Setting <code>requireManualApproval</code> to <code>false</code> will cause auto-propagation to the target environment.</li><li><strong>Build-and-Deploy-to-Target-Env:</strong> This stage uses <a href="https://aws.amazon.com/codebuild/" target="_blank" rel="noopener noreferrer">AWS CodeBuild</a> to perform build and deployment. It downloads the code from the artifacts S3 bucket and installs dependencies, performs the static code analysis, runs unit tests, and deploys to the target environment.</li><li><strong>Test-Target-Env:</strong> This stage uses <a href="https://aws.amazon.com/codebuild/" target="_blank" rel="noopener noreferrer">AWS CodeBuild</a> to execute integration tests against the target environment. This stage is only created if <code>runTestsAgainstTargetEnv</code> setting is set to <code>true</code> in settings file. Developers can set <code>createStagingEnv</code> to <code>false</code>, <code>requireManualApproval</code> to <code>false</code>, and <code>runTestsAgainstTargetEnv</code> to <code>true</code> to skip creation and deployment to staging environment and directly push changes to their target development environment without requiring manual approval and run integration tests directly against their target development environment.</li></ol></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="deploying-the-cicd-pipeline"></a>Deploying the CI/CD Pipeline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploying-the-cicd-pipeline" title="Direct link to heading">#</a></h2><p>Follow these steps to deploy the CI/CD Pipeline:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="1-deploy-the-cicd-source-stack-to-the-source-account"></a>1. Deploy the <code>cicd-source</code> stack to the Source Account<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-deploy-the-cicd-source-stack-to-the-source-account" title="Direct link to heading">#</a></h3><p>Start by creating a settings file in <code>cicd/cicd-source/config/settings</code> for the environment for which you want to create the CI/CD pipeline. For example, to create the CI/CD pipeline for <code>dev</code> environment, create a <code>dev.yml</code> file in <code>cicd/cicd-source/config/settings/</code>.</p><p>You can create the settings file by copying the sample <code>demo.yml</code> file. Please adjust the settings as per your environment. Read the inline comments in the file for information about each setting.
In the setting file you have just created, set the following settings as <code>&quot;*&quot;</code></p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">artifactsS3BucketArn: </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">artifactsKmsKeyArn: </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*&quot;</span></div></div></div></div></div><p>You can now deploy the <code>cicd-source</code> stack.</p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cicd/cicd-source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pnpx sls deploy --stage </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">env-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="2-deploy-cicd-pipeline-stack-to-the-target-account"></a>2. Deploy <code>cicd-pipeline</code> stack to the Target Account<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2-deploy-cicd-pipeline-stack-to-the-target-account" title="Direct link to heading">#</a></h3><p>Create a settings file in <code>cicd/cicd-pipeline/config/settings</code> for the environment for which you want to create the CI/CD pipeline. For example, to create the CI/CD pipeline for <code>dev</code> environment, create <code>dev.yml</code> file in <code>cicd/cicd-pipeline/config/settings/</code>. You can create the settings file by copying the sample <code>demo.yml</code> file.</p><p>Please adjust the settings as per your environment. Read inline comments in the file for information about each setting.</p><p>You can now deploy the <code>cicd-pipeline</code> stack:</p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cicd/cicd-pipeline</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pnpx sls deploy --stage </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">env-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="3-re-deploy-cicd-source-stack-to-the-source-account"></a>3. Re-deploy <code>cicd-source</code> stack to the Source Account<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-re-deploy-cicd-source-stack-to-the-source-account" title="Direct link to heading">#</a></h3><p>You will need to re-deploy the <code>cicd-source</code> stack to the Source Account to lock down permissions for the artifacts bucket.</p><p>Note down the CloudFormation stack output variables <code>AppArtifactBucketArn</code> and <code>ArtifactBucketKeyArn</code> from the <code>cicd-pipeline</code> stack you deployed above.</p><p>You can also use <code>sls info</code> command with <code>--verbose</code> flag to print stack output variables from the <code>cicd/cicd-pipeline</code>  folder:</p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pnpx sls info --verbose -s </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">env-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1d63" id="4-update-cloudformation-variables"></a>4. Update CloudFormation variables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4-update-cloudformation-variables" title="Direct link to heading">#</a></h3><p>Next you will need to set the CloudFormation stack output variables for <code>AppArtifactBucketArn</code> and <code>ArtifactBucketKeyArn</code> that you obtained in the previous steps for the settings <code>artifactsS3BucketArn</code> and <code>artifactsKmsKeyArn</code> in settings file <code>cicd/cicd-source/config/settings/demo.yml</code>.</p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">artifactsKmsKeyArn: </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;value of the CloudFormation output variable ArtifactBucketKeyArn from cicd-pipeline stack&gt;&quot;</span></div></div></div></div></div><p>Next you will need to re-deploy the <code>cicd-source</code> stack to lock down the permissions in <code>CodeCommitSourceRole</code>.</p><div class="mdxCodeBlock_Dtr0"><div class="codeBlockContent_2PPg"><button type="button" aria-label="Copy code to clipboard" class="copyButton_2nNw">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2VJL"><div class="codeBlockLines_2r9T" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cicd/cicd-source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pnpx sls deploy --stage </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">env-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/best_practices/aws_shield"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« AWS Shield</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/best_practices/rotating_jwt_token"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rotating the JWT Master Token Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2AdJ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#how-the-cicd-pipeline-works" class="table-of-contents__link">How the CI/CD pipeline works</a></li><li><a href="#deploying-the-cicd-pipeline" class="table-of-contents__link">Deploying the CI/CD Pipeline</a><ul><li><a href="#1-deploy-the-cicd-source-stack-to-the-source-account" class="table-of-contents__link">1. Deploy the <code>cicd-source</code> stack to the Source Account</a></li><li><a href="#2-deploy-cicd-pipeline-stack-to-the-target-account" class="table-of-contents__link">2. Deploy <code>cicd-pipeline</code> stack to the Target Account</a></li><li><a href="#3-re-deploy-cicd-source-stack-to-the-source-account" class="table-of-contents__link">3. Re-deploy <code>cicd-source</code> stack to the Source Account</a></li><li><a href="#4-update-cloudformation-variables" class="table-of-contents__link">4. Update CloudFormation variables</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/docs/styles.c0a53c60.js"></script>
<script src="/docs/runtime~main.76781b24.js"></script>
<script src="/docs/main.7eb1c7c3.js"></script>
<script src="/docs/1.7cbe52f2.js"></script>
<script src="/docs/2.49368f54.js"></script>
<script src="/docs/59.d1c041d7.js"></script>
<script src="/docs/935f2afb.1e90a91b.js"></script>
<script src="/docs/17896441.5294e2c1.js"></script>
<script src="/docs/890fe081.ca191dfd.js"></script>
</body>
</html>