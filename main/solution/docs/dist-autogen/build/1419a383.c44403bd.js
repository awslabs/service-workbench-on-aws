(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{116:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var o=n(0),i=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),p=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,r=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),d=p(n),b=o,m=d["".concat(r,".").concat(b)]||d[b]||u[b]||a;return n?i.a.createElement(m,l(l({ref:t},s),{},{components:n})):i.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=b;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},55:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(1),i=n(6),a=(n(0),n(116));const r={id:"configuring_idp",title:"Configuring an Identity Provider",sidebar_label:"Configuring an Identity Provider"},l={unversionedId:"deployment/configuration/auth/configuring_idp",id:"deployment/configuration/auth/configuring_idp",isDocsHomePage:!1,title:"Configuring an Identity Provider",description:"The solution uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0.",source:"@site/docs/deployment/configuration/auth/configuring_idp.md",slug:"/deployment/configuration/auth/configuring_idp",permalink:"/docs/deployment/configuration/auth/configuring_idp",version:"current",sidebar_label:"Configuring an Identity Provider",sidebar:"docs",previous:{title:"Auth0 Setup Introduction",permalink:"/docs/deployment/configuration/auth/configuring_auth0"},next:{title:"Deploying Updates",permalink:"/docs/deployment/redeployment"}},c=[{value:"Create a Relying Party (RP) in ADFS",id:"create-a-relying-party-rp-in-adfs",children:[]},{value:"Configure Relying Party information on the solution side",id:"configure-relying-party-information-on-the-solution-side",children:[]},{value:"Add Relying Party trust for the Cognito User Pool on the ADFS side",id:"add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side",children:[]}],s={rightToc:c};function p(e){let t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"The solution uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0."),Object(a.b)("p",null,"From SAML federation point of view, the Cognito User Pool is the Service Provider (SP) and takes care of processing SAML assertions and the ADFS is the Identity Provider (IdP). We need to establish mutual trust between the SP and the IdP."),Object(a.b)("h2",{id:"create-a-relying-party-rp-in-adfs"},"Create a Relying Party (RP) in ADFS"),Object(a.b)("p",null,"These steps may vary based on your AD/ADFS version. Please contact your system administrator for configuring a relying party and setting up trust in Active Directory."),Object(a.b)("p",null,"At high level the steps are as follows:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Login to your Active Directory Domain Controller Machine and type \u201cAD FS\u201d in the Run window and open \u201cAD FS 2.0 Management\u201d."),Object(a.b)("li",{parentName:"ol"},"Click \u201cAdd Relying Party Trust\u201d."),Object(a.b)("li",{parentName:"ol"},"In \u201cWelcome\u201d screen: Click Start."),Object(a.b)("li",{parentName:"ol"},"In \u201cSelect Data Source\u201d: Select \u201cEnter data about the relying party manually\u201d."),Object(a.b)("li",{parentName:"ol"},"In \u201cSpecify Display Name\u201d: Enter some display name and notes about the relying party (For example, \u201cCognito User Pool Relying Party\u201d)."),Object(a.b)("li",{parentName:"ol"},"In \u201cChoose Profile\u201d: Select \u201cAD FS 2.0 Profile\u201d."),Object(a.b)("li",{parentName:"ol"},"In \u201cConfigure Certificate\u201d: Do NOT configure any cert. This is for encrypting SAML claims. The SP (i.e., the Cognito User Pool in this case) need private key to decrypt the claims if you configure this. Amazon Cognito User Pools currently do not support encrypted SAML assertions."),Object(a.b)("li",{parentName:"ol"},"In \u201cConfigure URL\u201d: Do NOT select any box. Click Next."),Object(a.b)("li",{parentName:"ol"},"In \u201cConfigure Identifiers\u201d: Do not configure anything yet."),Object(a.b)("li",{parentName:"ol"},"In \u201cChoose Issuance Authorization Rules\u201d: Select \u201cPermit all users to access this relying party\u201d."),Object(a.b)("li",{parentName:"ol"},"In \u201cReady to Add Trust\u201d: Click Next."),Object(a.b)("li",{parentName:"ol"},"In \u201cFinish\u201d: Click Close."),Object(a.b)("li",{parentName:"ol"},"Next we need to configure claim attributes we want to be part of the SAML assertion. These attributes will be read by Cognito User Pool and mapped into standard Cognito Attributes as per the mapping configuration on the Cognito side."),Object(a.b)("li",{parentName:"ol"},"To configure claims, the \u201cEdit Claims\u201d window may already be open at this point from last wizard. If not, you can open it by clicking the \u201cEdit Claim Rules\u201d link."),Object(a.b)("li",{parentName:"ol"},"To configure claims, the \u201cEdit Claims\u201d window may already be open at this point from last wizard. If not, you can open it by clicking the \u201cEdit Claim Rules\u201d link.",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"Add the following claims:",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"Name ID"),Object(a.b)("li",{parentName:"ol"},"Name"),Object(a.b)("li",{parentName:"ol"},"Mail"),Object(a.b)("li",{parentName:"ol"},"Surname"),Object(a.b)("li",{parentName:"ol"},"Given Name"))))),Object(a.b)("li",{parentName:"ol"},"To add Name ID claim:",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"Click \u201cAdd Rule\u201d."),Object(a.b)("li",{parentName:"ol"},"Select \u201cTransform an Incoming Claim\u201d, Click Next and then configure the Claim."))),Object(a.b)("li",{parentName:"ol"},"Similarly add Name claim."),Object(a.b)("li",{parentName:"ol"},"To add E-Mail claim:",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"Click \u201cAdd Rule\u201d."),Object(a.b)("li",{parentName:"ol"},"Select \u201cSend LDAP Attributes as Claims\u201d, Click Next and then configure the Claim."))),Object(a.b)("li",{parentName:"ol"},"Similarly add the Surname and Given Name claims.")),Object(a.b)("h2",{id:"configure-relying-party-information-on-the-solution-side"},"Configure Relying Party information on the solution side"),Object(a.b)("p",null,"Once you have created a Relying Party in ADFS you can then configure it within the Research as a Service solution."),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Extract the SAML metadata file from ADFS. The location of the metadata file may be different depending upon your version of AD/ADFS. Usually it is available at the following location: ",Object(a.b)("inlineCode",{parentName:"li"},"https://<DomainControllerDNSName>/FederationMetadata/2007-06/FederationMetadata.xml.")),Object(a.b)("li",{parentName:"ol"},"Copy the above metadata file and place it at ",Object(a.b)("inlineCode",{parentName:"li"},"/solution/post-deployment/config/saml-metadata/metadata.xml"),"."),Object(a.b)("li",{parentName:"ol"},"Adjust your component specific settings file for the post-deployment component at ",Object(a.b)("inlineCode",{parentName:"li"},"/solution/post-deployment/config/settings/<your-environment-name>.yml")," and specify the ",Object(a.b)("inlineCode",{parentName:"li"},"fedIdpMetadatas")," setting as follows:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-bash"}),"fedIdpMetadatas: '[\"s3://${self:custom.settings.namespace}-artifacts/saml-metadata/metadata.xml\"]'\n")),Object(a.b)("h2",{id:"add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side"},"Add Relying Party trust for the Cognito User Pool on the ADFS side"),Object(a.b)("p",null,"When you deploy the solution following the ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"/docs/deployment/deployment/index"}),Object(a.b)("strong",{parentName:"a"},"Initial Deployment"))," instructions, a Cognito User Pool is created. Follow these steps to add a Relying Party trust for the Cognito User Pool:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Log in to the AWS console and navigate to Amazon Cognito."),Object(a.b)("li",{parentName:"ol"},"Select User Pools, you should see a user pool for your environment. The name of the Cognito User Pool will be in the following format ",Object(a.b)("inlineCode",{parentName:"li"},"<envName>-<solutionName>-userpool"),". The ",Object(a.b)("inlineCode",{parentName:"li"},"<envName>")," and the ",Object(a.b)("inlineCode",{parentName:"li"},"<solutionName>")," values here would be the values you specified for the corresponding settings in your settings file."),Object(a.b)("li",{parentName:"ol"},"Select the user pool for your environment and take note of the following values:",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"User pool ID: Copy the value for field \u201cPool Id\u201d."),Object(a.b)("li",{parentName:"ol"},"Domain prefix: Navigate to \u201cApp integration \uf0e0 Domain name\u201d for your user pool and copy the value of the domain prefix."))),Object(a.b)("li",{parentName:"ol"},"Login to your ADFS domain controller to add Cognito User Pool related information to configure trust.",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"Open AD FS Management application."),Object(a.b)("li",{parentName:"ol"},"Navigate to \u201cRelying Party Trusts\u201d."),Object(a.b)("li",{parentName:"ol"},"Select the relying party you want to add trust to."),Object(a.b)("li",{parentName:"ol"},"Open the \u201cIdentifiers\u201d tab."),Object(a.b)("li",{parentName:"ol"},"Enter the URN of the Cognito User Pool and click \u201cAdd\u201d. The URN would be in the following format: ",Object(a.b)("inlineCode",{parentName:"li"},"urn:amazon:cognito:sp:<userPoolId>"),". Replace the ",Object(a.b)("inlineCode",{parentName:"li"},"<userPoolId>")," with the value of the User pool ID you obtained earlier."),Object(a.b)("li",{parentName:"ol"},"Open the \u201cEndpoints\u201d tab and add the Service Provider (Cognito SAML assertion consumer) URL that will receive the SAML assertion from IdP. The url has the following format: ",Object(a.b)("inlineCode",{parentName:"li"},"https://<userPoolDomain>.auth.<region>.amazoncognito.com/saml2/idpresponse"),". Replace ",Object(a.b)("inlineCode",{parentName:"li"},"<userPoolDomain>")," with the value of the \u201cDomain prefix\u201d you obtained earlier. Replace the value of ",Object(a.b)("inlineCode",{parentName:"li"},"<region>")," with the region where you deployed the solution to.")))),Object(a.b)("p",null,"You should now be able to log in to the Research as a Service solution using your AD credentials."))}p.isMDXComponent=!0}}]);