(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{109:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return u})),n.d(t,"default",(function(){return b}));var a=n(1),r=n(6),o=(n(0),n(116)),c=n(118);const i={id:"link_aws_account",title:"Create or add an AWS Account",sidebar_label:"Create or add an AWS Account"},l={unversionedId:"deployment/post_deployment/link_aws_account",id:"deployment/post_deployment/link_aws_account",isDocsHomePage:!1,title:"Create or add an AWS Account",description:"After logging in as root for the first time, from the SideBar's Accounts page, create an AWS Account",source:"@site/docs/deployment/post_deployment/link_aws_account.md",slug:"/deployment/post_deployment/link_aws_account",permalink:"/docs/deployment/post_deployment/link_aws_account",version:"current",sidebar_label:"Create or add an AWS Account",sidebar:"docs",previous:{title:"Post Deployment",permalink:"/docs/deployment/post_deployment/index"},next:{title:"Create Indexes and Projects",permalink:"/docs/deployment/post_deployment/create_index_project"}},u=[{value:"Create Interal AWS Account",id:"create-interal-aws-account",children:[{value:"Create AWS Organization",id:"create-aws-organization",children:[]},{value:"Get Master Account Role ARN",id:"get-master-account-role-arn",children:[]},{value:"Create AWS Account",id:"create-aws-account",children:[]}]},{value:"Add External AWS Account",id:"add-external-aws-account",children:[]}],s={rightToc:u};function b(e){let t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"After logging in as root for the first time, from the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/user_guide/introduction"}),"SideBar's Accounts page"),", create an AWS Account\nwithin the solution UI. Every user belongs to an Account, so this step must be\ncompleted before creating the first user."),Object(o.b)("p",null,"There are two categories of AWS Account within the solution: Internal and\nExternal. Internal accounts are those linked to the AWS account from\nwhich you deployed the solution. Users linked to an internal account will all\nbe billed to that AWS account. External accounts supply their own AWS\naccount, and users linked to an external account are billed to the\nexternal AWS account. This is how external researchers can collaborate\nand share data within the solution but remain responsible for their own\nbilling."),Object(o.b)("h2",{id:"create-interal-aws-account"},"Create Interal AWS Account"),Object(o.b)("p",null,"In this step you will run a script that creates an ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/deployment/reference/iam_role"}),"IAM Role")," allowing the\nMain account to assume role into the Master account. The ARN of this\nrole is used to create a new account within the solution."),Object(o.b)("h3",{id:"create-aws-organization"},"Create AWS Organization"),Object(o.b)("p",null,"In the AWS console, create an ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/deployment/reference/aws_services"}),"Organization")," in the Master account. There is no configuration; the solution\nwill create a new account in the Organization for this deployment, named\nafter the stage name used at deployment. If you already have an\nOrganization created there is no further action required."),Object(o.b)("h3",{id:"get-master-account-role-arn"},"Get Master Account Role ARN"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Read ",Object(o.b)("inlineCode",{parentName:"p"},"main/solution/prepare-master-acc/README.md"))),Object(o.b)("li",{parentName:"ul"})),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"Run `scripts/master-account-deploy.sh <stage>`\n\n:   -   This will take about 8 minutes\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Copy the displayed ARN of the newly-created master role")),Object(o.b)("h3",{id:"create-aws-account"},"Create AWS Account"),Object(o.b)("p",null,"This will create an account whose billing will go to the Main account\n(the account in which the solution is deployed)"),Object(o.b)("img",{src:Object(c.a)("img/deployment/post_deployment/create_account_00.jpg")}),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"In the solution UI, go to Accounts \u2192 AWS Accounts and click\n",Object(o.b)("strong",{parentName:"p"},"Create AWS Account")),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},"Fill in Master Role ARN copied from the previous step"),Object(o.b)("li",{parentName:"ul"},"The email address must be unique within the Organization"),Object(o.b)("li",{parentName:"ul"},"There is a default External ID string. See ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"/deployment/reference/iam_role"}),"IAM Role")," for how to\nconfigure this to another value.")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Click ",Object(o.b)("strong",{parentName:"p"},"Create AWS Account")," and after a minute you should see:"),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"'Trying to create accountID: xxx' in the AWS Accounts tab")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"A workflow in progress in Workflows \u2192 Provision Account (see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/user_guide/introduction"}),"SideBar's Accounts page"),")"),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},"If instead you see an error message 'Stop Internal State\nAccount ID not found', check the AWS Organization in the\nconsole of your Master account. Your account must not\nbelong to an existing Organization. You must either have\nan existing Organization or be able to create an\nOrganization")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"In the AWS console you can optionally inspect the resources\ndeployed by this script:"),Object(o.b)("blockquote",{parentName:"li"},Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},"In CloudFormation, a stack ",Object(o.b)("inlineCode",{parentName:"li"},"prep-master")," will be\nrunning. It creates the master role and its output is\nthe master role ARN."),Object(o.b)("li",{parentName:"ul"},"In the AWS Organization in the Master account (see\n",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"/deployment/reference/aws_services"}),"Organization"),"), the new account will appear"),Object(o.b)("li",{parentName:"ul"},"In IAM, the new master role will be created"))))))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Once the account has been added it will be listed in ",Object(o.b)("strong",{parentName:"p"},"AWS\nAccounts")))),Object(o.b)("img",{src:Object(c.a)("img/deployment/post_deployment/create_account_02.jpg")}),Object(o.b)("h2",{id:"add-external-aws-account"},"Add External AWS Account"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"This will create an account whose billing will go to an external AWS\naccount (such as for an external researcher)"),Object(o.b)("li",{parentName:"ul"},"Deploy\n",Object(o.b)("inlineCode",{parentName:"li"},"addons/addon-base-raas/packages/base-raas-cfn-templates/src/templates/onboard-account.cfn.yml")),Object(o.b)("li",{parentName:"ul"},"This will output Role ARN, VPC ID etc"),Object(o.b)("li",{parentName:"ul"},"Open the Accounts tab when logged in as an Administrator user to the solution UI, select\n'Add AWS Account', and enter this information.")),Object(o.b)("img",{src:Object(c.a)("img/deployment/post_deployment/create_account_01.jpg")}))}b.isMDXComponent=!0},116:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),s=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=s(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),b=s(n),d=a,m=b["".concat(c,".").concat(d)]||b[d]||p[d]||o;return n?r.a.createElement(m,i(i({ref:t},u),{},{components:n})):r.a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var u=2;u<o;u++)c[u]=n[u];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},117:function(e,t,n){"use strict";var a=n(0),r=n(20);t.a=function(){const e=Object(a.useContext)(r.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},118:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return c}));var a=n(117),r=n(119);function o(){const e=Object(a.a)().siteConfig,t=void 0===e?{}:e,n=t.baseUrl,o=void 0===n?"/":n,c=t.url;return{withBaseUrl:(e,t)=>function(e,t,n,{forcePrependBaseUrl:a=!1,absolute:o=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if(Object(r.b)(n))return n;if(a)return t+n;const c=n.startsWith(t)?n:t+n.replace(/^\//,"");return o?e+c:c}(c,o,e,t)}}function c(e,t={}){return(0,o().withBaseUrl)(e,t)}},119:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}))}}]);